<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ginkgocap.ywxt.knowledge.mapper.KnowledgeCategoryValueMapper" >
 
 
 <insert id="batchInsert" parameterType="java.util.List">
 
 insert into tb_knowledge_category (
			knowledge_id,
			category_id,
			status
			
		) values 
		 	<foreach collection="list" item="item" index="index" separator="," >  
        (#{item.knowledgeId},
				 #{item.categoryId},
				 #{item.status}
				 )  
    </foreach>  
 </insert>
 <select id="selectKnowledgeIds" resultType="map" >
	SELECT DISTINCT b.*,
	CASE
	        WHEN b.user_id=#{userId} THEN 'me'
	        ELSE 'other'
	END source
	FROM tb_knowledge_category kc,
	tb_user_category
	uc,tb_knowledge_base b
	WHERE kc.category_id = uc.id
	AND b.knowledge_id=kc.knowledge_id
	AND kc.status=1
	AND uc.category_type = 0
	AND uc.user_id=#{userId}
	<if test="sortId !=null and sortId != ''">
	AND uc.sortid =#{sortId} 
	</if>
	<if test="tid !=null and tid!=''">
		AND b.column_type=#{tid}
	</if>
	<if test="lid == 0 ">
		AND b.user_id=#{userId}
	</if>
	<if test="lid == 1 ">
		AND b.user_id!=#{userId}
	</if>
	<if test="keyword !=null and keyword != '' ">
		AND b.title like CONCAT('%',#{keyword},'%')
	</if>
	ORDER BY b.createtime DESC
	LIMIT #{start},#{size}
</select>
 <select id="countKnowledgeIds" resultType="int" >
 		select count(1) from (
			SELECT DISTINCT b.*
			FROM tb_knowledge_category kc,
			tb_user_category
			uc,tb_knowledge_base b
			WHERE kc.category_id = uc.id
			AND b.knowledge_id=kc.knowledge_id
			AND kc.status=1
			AND uc.category_type = 0
			AND uc.user_id=#{userId}
			<if test="sortId !=null and sortId != ''">
				AND uc.sortid =#{sortId} 
			</if>
			<if test="tid !=null and tid!=''">
				AND b.column_type=#{tid}
			</if>
			<if test="lid == 0 ">
				AND b.user_id=#{userId}
			</if>
			<if test="lid == 1 ">
				AND b.user_id!=#{userId}
			</if>
			<if test="keyword !=null and keyword != '' ">
				AND b.title like CONCAT('%',#{keyword},'%')
			</if>
		)j
</select>

 <delete id="deleteKnowledge">
  delete from tb_knowledge_category 
     where  category_id=#{categoryid} 
     and  knowledge_id in 
     <foreach item="knowledgeids" collection="knowledgeids" open="(" separator="," close=")">
     #{knowledgeids}
 	</foreach>
 </delete>
</mapper>