<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="tb_knowledge_category">
	<typeAlias alias="knowledgecategory" type="com.ginkgocap.ywxt.knowledge.model.KnowledgeRCategory"/>
	<resultMap class="com.ginkgocap.ywxt.knowledge.model.KnowledgeRCategory" id="knowledgecategoryMap">
		<result column="id" property="id" jdbcType="BIGINT"/>
		<result column="knowledge_id" property="knowledgeid" jdbcType="BIGINT"/>
		<result column="category_id" property="categoryid" jdbcType="BIGINT"/>
		<result column="status" property="status" jdbcType="VARCHAR"/>
		<result column="sortid" property="sortId" jdbcType="VARCHAR"/>
		<result column="user_id" property="userid" jdbcType="BIGINT"/>
		<result column="title" property="title" jdbcType="VARCHAR"/>
		<result column="author" property="author" jdbcType="VARCHAR"/>
		<result column="path" property="path" jdbcType="SMALLINT"/>
		<result column="share_author" property="share_author" jdbcType="VARCHAR"/>
		<result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
		<result column="tag" property="tag" jdbcType="VARCHAR"/>
		<result column="know_desc" property="know_desc" jdbcType="VARCHAR"/>
		<result column="column_id" property="column_id" jdbcType="BIGINT"/>
		<result column="pic_path" property="pic_path" jdbcType="VARCHAR"/>
		
	</resultMap>
	
	<sql id="dyColumns">id,knowledge_id,category_id,status,sortid</sql>
	
	<update id="update" parameterClass="java.util.Map" >  
        UPDATE tb_knowledge_category SET  
	        category_id = #categoryid:BIGINT#,
			sortid = #sortId:VARCHAR#
        WHERE   
        	knowledge_id = #knowledgeid:BIGINT#   
    </update>
    
    <delete id="delete" parameterClass="java.util.Map">
    delete from tb_knowledge_category 
     where  category_id=#categoryid:BIGINT# 
     and  knowledge_id in 
      <iterate property="knowledgeids" open="(" close=")" conjunction=",">#knowledgeids[]#</iterate>
    </delete>
    
     <delete id="deleteknowledgeid" parameterClass="java.util.Map">
    delete from tb_knowledge_category 
     where  category_id=#categoryid:BIGINT# 
     and  knowledge_id =#knowledgeid:BIGINT# 
    </delete>
    

	<insert id="batchInsert" parameterClass="java.util.List">
		insert into tb_knowledge_category (
			knowledge_id,
			category_id,
			sortid,
			user_id,
			title,
			author,
			path,share_author,createtime,tag,know_desc,column_id,pic_path
			
		) values 
		 	<iterate conjunction=",">
				(#list[].knowledgeid#,
				 #list[].categoryid#,
				 #list[].sortId#,
				 #list[].userid#, #list[].title#, #list[].author#, #list[].path#, #list[].share_author#,
				 #list[].createtime#,#list[].tag#,#list[].know_desc#,#list[].column_id#,#list[].pic_path#
				)
		 	</iterate>
	</insert>
	
	<insert id="insert" parameterClass="knowledgecategory">
		insert into tb_knowledge_category(
			knowledge_id,
			category_id,
			status,
			sortid,
			user_id,
			title,
			author,
			path,
			share_author,
			createtime,
			tag,
			know_desc,
			column_id,
			pic_path
			
		) values (
			#knowledgeid:BIGINT#,
			#categoryid:BIGINT#,
			#status:VARCHAR#,
			#sortId:VARCHAR#,
			#userid:BIGINT#,
			#title:VARCHAR#,
			#author:VARCHAR#,
			#path:VARCHAR#,
			#share_author:VARCHAR#,
			#createtime:VARCHAR#,
			#tag:VARCHAR#,
			#know_desc:VARCHAR#,
			#column_id:BIGINT#,
			#pic_path:VARCHAR#
			
		)
		<selectKey resultClass="long" type="post" keyProperty="id" > 
		SELECT LAST_INSERT_ID() AS VALUE     
		</selectKey>
	</insert>

	<!-- ========================================查询目录下知识的个数 begin======================================= -->
	
	<select id="countByKnowledgeCategoryId" resultClass="long" parameterClass="long">
		SELECT count(*) FROM tb_knowledge_category WHERE STATUS=1 AND category_id=#id#
	</select>
	
	<!-- ========================================查询目录下知识的个数 end======================================= -->
	
</sqlMap>